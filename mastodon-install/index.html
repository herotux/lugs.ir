<!DOCTYPE html>
<html dir="rtl" lang="fa">

<head>
  <title>نصب Mastodon در اوبونتو – حمید صیدی – وبلاگ شخصی جایی برای نوشتن!</title>

      <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>
     
    
    <meta name="description" content="


Mastodon یک پلت فرم شبکه اجتماعی رایگان و رایگان است که بسیار شبیه توییتر است. هر کسی می تواند Mastodon را اجرا کند و در یک شبکه اجتماعی یکپارچه شرکت کند. این در روبی و جاوا اسکریپت نوشته شده است.

" />
    <meta property="og:description" content="


Mastodon یک پلت فرم شبکه اجتماعی رایگان و رایگان است که بسیار شبیه توییتر است. هر کسی می تواند Mastodon را اجرا کند و در یک شبکه اجتماعی یکپارچه شرکت کند. این در روبی و جاوا اسکریپت نوشته شده است.

" />
    <meta name="twitter:description" content="


Mastodon یک پلت فرم شبکه اجتماعی رایگان و رایگان است که بسیار شبیه توییتر است. هر کسی می تواند Mastodon را اجرا کند و در یک شبکه اجتماعی یکپارچه شرکت کند. این در روبی و جاوا اسکریپت نوشته شده است.

" />
    
    <meta property="author" content="حمید صیدی" />
    
    <meta name="keywords" content="mastodon,learn," />
    
    
    <meta property="og:title" content="نصب Mastodon در اوبونتو" />
    <meta name="twitter:title" content="نصب Mastodon در اوبونتو" />
    
    
    <meta name="twitter:site" content="@rasooll_">
    <meta name="twitter:creator" content="@rasooll_">
    <meta property="og:url" content="http://freetux.ir/mastodon-install/">
    <meta property="og:locale" content="fa">
    <link rel="author" href="http://freetux.ir">
    <link rel="shortcut icon" href="http://freetux.ir/images/favicon.png" type="image/png" sizes="150x150"> 


  <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->


  <link rel="stylesheet" type="text/css" href="/style.css" />
  <link rel="alternate" type="application/rss+xml" title="حمید صیدی - وبلاگ شخصی جایی برای نوشتن!" href="/feed.xml"/>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
  
    






  

</head>

<body>
  <div class="container">
    <div class="row">
      <div class="col-md-7">
        <header class="siteinfo">
          <a href="/">
            <img src="/images/freetux.png" alt="آواتار حمید صیدی" class="rounded avatar" />
          </a>
          <a href="/" class="sitename">
            <h1>حمید صیدی</h1>
          </a>
          <p class="sitedescription">وبلاگ شخصی جایی برای نوشتن!</p>
        </header>
      </div>
      <div class="col-md-5">
        <nav class="font-titr topbar">
          <div class="vertical-middle">
            <a href="/archive">آرشیو</a>
            <a href="/about">درباره‌ی من</a>
            <a href="/contact">تماس با من</a>
          </div>
        </nav>
      </div>
    </div>
    <div class="hrbtm"> </div>
  </div>

  <div class="container">
    <div class="row">
      <div class="col-12">
        <article class="post">
  <h1>نصب Mastodon در اوبونتو</h1>
  <span>[
    
      
      <a href="/tag/mastodon"><code class="highligher-rouge"><nobr>mastodon</nobr></code>&nbsp;</a>
    
      
      <a href="/tag/learn"><code class="highligher-rouge"><nobr>learn</nobr></code>&nbsp;</a>
    
  ]</span>

  <div class="content">
    <div align="center" style="font-size: 50px;">
<i class="fab fa-mastodon" aria-hidden="true" style="color: #333;"></i>
</div>
<p>Mastodon یک پلت فرم شبکه اجتماعی رایگان و رایگان است که بسیار شبیه توییتر است. هر کسی می تواند Mastodon را اجرا کند و در یک شبکه اجتماعی یکپارچه شرکت کند. این در روبی و جاوا اسکریپت نوشته شده است.</p>

<p>در این آموزش ما Mastodon را در سرور اوبونتو 16.04 نصب خواهیم کرد.</p>

<h2 id="الزامات">الزامات</h2>

<ul>
  <li>یک سرور اوبونتو</li>
  <li>یک کاربر معمولی با تنظیمات sudo در سرور شما.</li>
</ul>

<h2 id="نصب-وابستگی-های-مورد-نیاز">نصب وابستگی های مورد نیاز</h2>

<p>اولا توصیه می شود سرور خود را با آخرین نسخه به روز کنید. شما می توانید این کار را با اجرای دستور زیر انجام دهید:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo apt-get update -y sudo apt-get upgrade -y
</code></pre>
</div>

<p>هنگامی که سیستم شما به روز می شود، سیستم خود را مجددا راه اندازی کنید و با کاربر sudo وارد شوید.</p>

<p>بعد، شما باید برخی از وابستگی های مورد نیاز را در سرور خود نصب کنید. شما می توانید همه آنها را با اجرای دستور زیر نصب کنید:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo curl -sL https://deb.nodesource.com/setup_4.x | sudo bash - sudo curl -sL https://deb.nodesource.com/setup_4.x | sudo bash - sudo apt-get install imagemagick ffmpeg libpq-dev libxml2-dev libxslt1-dev nodejs -y sudo npm install -g yarn

</code></pre>
</div>

<p>بعد، شما همچنین باید سرور redis را در سیستم خود نصب کنید. شما می توانید آن را فقط با اجرای دستور زیر نصب کنید:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo apt-get install redis-server redis-tools -y
</code></pre>
</div>

<p>بعد Postgresql را نصب کنید.</p>

<h2 id="نصب-و-پیکربندی-postgresql">نصب و پیکربندی PostgreSQL</h2>

<p>Mastodon از پایگاه داده PostgreSQL استفاده می کند، بنابراین شما باید PostgreSQL و daemon را نصب کنید. شما می توانید آنها را با دستور زیر نصب کنید:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo apt-get install postgresql pidentd -y
</code></pre>
</div>

<p>پس از اتمام نصب، daemon id را با دستور زیر شروع کنید:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo systemctl start pidentd
</code></pre>
</div>

<p>بعد، برای ورود به کاربر postgre وارد شوید و یک کاربر برای Mastodon ایجاد کنید:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo su - postgres psql CREATE USER mastodon CREATEDB; exit
</code></pre>
</div>

<p>بعد، شما نیاز دارید که کاربران بتوانند بدون رمز عبور وارد شوند. شما می توانید این کار را با اجرای دستور زیر انجام دهید:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo sed -i '/^local.*postgres.*peer$/a host all all 127.0.0.1/32 ident' /etc/postgresql/9.?/main/pg_hba.conf
</code></pre>
</div>

<p>پس از پایان کار، PostgreSQL را مجددا راه اندازی کنید تا تغییرات اعمال شود.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo systemctl postgresql restart
</code></pre>
</div>

<h2 id="نصب-روبی">نصب روبی</h2>

<p>Mastodon برنامه مبتنی بر Ruby است. بنابراین شما باید Ruby و تمام وابستگی های مورد نیاز را به سرور خود نصب کنید.</p>

<p>شما می توانید همه آنها را با اجرای دستور زیر نصب کنید:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo apt-get install autoconf bison build-essential libssl-dev libyaml-dev libncurses5-dev libffi-dev libgdbm3 libreadline6-dev zlib1g-dev libgdbm-dev -y
</code></pre>
</div>

<p>پس از نصب تمام بسته ها، یک کاربر به نام mastodon بدون رمز عبور ایجاد کنید:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo adduser --disabled-password --disabled-login mastodon
</code></pre>
</div>

<p>بعد، با mastodon وارد شوید و rbenv و rbenv-build را با دستور زیر نصب کنید:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>su - mastodon git clone https://github.com/rbenv/rbenv.git ~/.rbenv echo 'export PATH="$HOME/.rbenv/bin:$PATH"' &gt;&gt; ~/.bashrc echo 'eval "$(rbenv init -)"' &gt;&gt; ~/.bashrc source ~/.bashrc
</code></pre>
</div>

<p>بعد از کاربر mastodon خارج شده و دوباره وارد شوید تا تغییرات bash اعمال شود:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>exit su - mastodon git clone https://github.com/rbenv/ruby-build.git ~/.rbenv/plugins/ruby-build
</code></pre>
</div>

<p>بعد، برای نصب ruby 2.4.1 برای mastodon دستور زیر را وارد کنید:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>rbenv install 2.4.1 rbenv global 2.4.1
</code></pre>
</div>

<p>هنگامی که نصب کامل است، می توانید نسخه ruby ​​را با دستور زیر بررسی کنید:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>ruby -v
</code></pre>
</div>

<h2 id="نصب-mastodon">نصب Mastodon</h2>

<p>اکنون، تمام وابستگی های لازم برای راه اندازی Mastodon نصب شده اند. بنابراین آخرین نسخه Mastodon را از مخزن Git دانلود کنید. برای انجام این کار، دستور زیر را اجرا کنید:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>git clone https://github.com/tootsuite/mastodon.git live cd live git checkout $(git tag | tail -n 1)
</code></pre>
</div>

<p>بعد نصب bundler برای مدیریت وابستگی ها و غیرفعال کردن داکیومنت های gem دستور زیر را وارد کنید:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>echo "gem: --no-document" &gt; ~/.gemrc gem install bundler --no-ri
</code></pre>
</div>

<p>بعد، Mastodon را با دستور زیر نصب کنید:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>bundle install --deployment --without development test
</code></pre>
</div>

<p>پس از تکمیل نصب، یک فایل پیکربندی برای Mastodon ایجاد کنید:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>cp .env.production.sample .env.production nano .env.production
</code></pre>
</div>

<p>مطالب زیر را اضافه کنید:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>REDIS_HOST=localhost
REDIS_PORT=6379
DB_HOST=/var/run/postgresql
DB_USER=mastodon
DB_NAME=mastodon_production
DB_PASS=
DB_PORT=5432# Federation
LOCAL_DOMAIN=yourdomain.com
LOCAL_HTTPS=true
</code></pre>
</div>

<p>پس از اتمام، فایل را ذخیره کرده و آن را ببندید.</p>

<h2 id="فایل-mastodon-systemd-را-ایجاد-کنید">فایل Mastodon Systemd را ایجاد کنید</h2>

<p>بعد، شما باید یک وب سرویس Mastodon systemd، خدمات پس زمینه و سرویس سرویس API برای Mastodon ایجاد کنید.</p>

<p>اول، یک فایل وب سرویس با دستور زیر ایجاد کنید:</p>
<div class="highlighter-rouge"><pre class="highlight"><code>nano /etc/systemd/system/mastodon-web.service
</code></pre>
</div>

<p>خطوط زیر را اضافه کنید:</p>

<div class="highlighter-rouge"><pre class="highlight"><code> [Unit]
 Description=mastodon-web
 After=network.target[Service]
 Type=simple
 User=mastodon
 WorkingDirectory=/home/mastodon/live
 Environment="RAILS_ENV=production"
 Environment="PORT=3000"
 ExecStart=/home/mastodon/.rbenv/shims/bundle exec puma -C config/puma.rb
 TimeoutSec=15
 Restart=always[Install]
 WantedBy=multi-user.target
</code></pre>
</div>
<p>بعد، یک فایل سرویس Backgroud ایجاد کنید:</p>

<p><code class="highlighter-rouge">nano /etc/systemd/system/mastodon-sidekiq.service</code></p>

<p>خطوط زیر را اضافه کنید:</p>

<div class="highlighter-rouge"><pre class="highlight"><code> Unit]
 Description=mastodon-sidekiq
 After=network.target[Service]
 Type=simple
 User=mastodon
 WorkingDirectory=/home/mastodon/live
 Environment="RAILS_ENV=production"
 Environment="DB_POOL=5"
 ExecStart=/home/mastodon/.rbenv/shims/bundle exec sidekiq -c 5 -q default -q mailers -q pull -q push
 TimeoutSec=15
 Restart=always[Install]
 WantedBy=multi-user.target
</code></pre>
</div>

<p>بعد، یک فایل سرویس API ایجاد کنید:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>nano /etc/systemd/system/mastodon-streaming.service
</code></pre>
</div>

<p>خطوط زیر را اضافه کنید:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[Unit]
 Description=mastodon-streaming
 After=network.target[Service]
 Type=simple
 User=mastodon
 WorkingDirectory=/home/mastodon/live
 Environment="NODE_ENV=production"
 Environment="PORT=4000"
 ExecStart=/usr/bin/npm run start
 TimeoutSec=15
 Restart=always[Install]
 WantedBy=multi-user.target
</code></pre>
</div>

<p>فایل را ذخیره و بسته کنید، سپس این فایل سرویس را با دستور زیر فعال کنید:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo systemctl enable /etc/systemd/system/mastodon-*.service sudo systemctl enable /etc/systemd/system//etc/systemd/system//etc/systemd/system/mastodon-web.service sudo systemctl enable /etc/systemd/system//etc/systemd/system/mastodon-streaming.service
</code></pre>
</div>

<p>بعد، سرور Mastodon را با دستور زیر شروع کنید:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo systemctl start mastodon-web.service sudo systemctl start mastodon-sidekiq.service sudo systemctl start mastodon-streaming.service
</code></pre>
</div>

<h2 id="پیکربندی-nginx-برای-mastodon">پیکربندی Nginx برای Mastodon</h2>

<p>بعد، شما باید reverse-proxy را با استفاده از Nginx برای دسترسی به Mastodon با نام دامنه خود تنظیم کنید.</p>

<p>اول، Nginx را با دستور زیر نصب کنید:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo apt-get install nginx -y
</code></pre>
</div>

<p>بعد، بلوک سرور مجازی Nginx را برای Mastodon ایجاد کنید.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo nano /etc/nginx/sites-enabled/mastodon.conf
</code></pre>
</div>

<p>خطوط زیر را اضافه کنید:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>map $http_upgrade $connection_upgrade {
 default upgrade;
 '' close;
}
server {
 listen 80;
 listen [::]:80;
 server_name www.yourdomain.com yourdomain.com;
 return 301 https://votredomaine.com$request_uri;access_log /dev/null;
 error_log /dev/null;
}server {
 listen 443 ssl http2;
 listen [::]:443 ssl http2;
 server_name www.yourdomain.com yourdomain.com;access_log /var/log/nginx/yourdomain.com-access.log;
 error_log /var/log/nginx/yourdomain.com-error.log;ssl_certificate /etc/letsencrypt/live/fullchain.pem;
 ssl_certificate_key /etc/letsencrypt/live/privkey.pem;
 ssl_protocols TLSv1.2;
 ssl_ciphers EECDH+AESGCM:EECDH+AES;
 ssl_prefer_server_ciphers on;
 add_header Strict-Transport-Security "max-age=15552000; preload";keepalive_timeout 70;
 sendfile on;
 client_max_body_size 0;
 gzip off;root /home/mastodon/live/public;location / {
  try_files $uri @proxy;
 }location @proxy {
  proxy_set_header Host $host;
  proxy_set_header X-Real-IP $remote_addr;
  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  proxy_set_header X-Forwarded-Proto https;
  proxy_pass_header Server;
  proxy_pass http://127.0.0.1:3000;
  proxy_buffering off;
  proxy_redirect off;
  proxy_http_version 1.1;
  proxy_set_header Upgrade $http_upgrade;
  proxy_set_header Connection $connection_upgrade;
  tcp_nodelay on;
 }location /api/v1/streaming {
  proxy_set_header Host $host;
  proxy_set_header X-Real-IP $remote_addr;
  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
  proxy_set_header X-Forwarded-Proto https;
  proxy_pass http://127.0.0.1:4000;
  proxy_buffering off;
  proxy_redirect off;
  proxy_http_version 1.1;
  proxy_set_header Upgrade $http_upgrade;
  proxy_set_header Connection $connection_upgrade;
  tcp_nodelay on;
 }

error_page 500 501 502 503 504 /500.html; } 
</code></pre>
</div>

<p>فایل را ذخیره کنید، سپس Nginx را با دستور زیر دوباره راه اندازی کنید:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>systemctl restart nginx

</code></pre>
</div>

<p>در نهایت، مرورگر وب خود را باز کنید و  http // yourdomain.com خود را تایپ کنید تا به Mastodon install دسترسی داشته باشید.</p>

  </div>

  <div class="date">
    نوشته شده در شنبه 14 مهر 1397
  </div>
  <div class="paginate">
    <div class="row">
    <div class="col-sm-6">
      
        <a href="http://freetux.ir/%D9%85%D9%81%D9%87%D9%88%D9%85-rebase/" title="مفهوم rebase">
          <div class=" post-pg-btn post-previous">
            <i class="fa fa-arrow-right pull-right" aria-hidden="true"></i> مفهوم rebase
          </div>
        </a>
      
    </div>
    <div class="col-sm-6">
      
        <a href="http://freetux.ir/alias/" title="فرمان alias">
          <div class=" post-pg-btn post-next">
              <i class="fa fa-arrow-left pull-left" aria-hidden="true"></i> فرمان alias
          </div>
        </a>
      
    </div>
  </div>
  </div>
  <br />
  
<div class="comments">
	<div id="disqus_thread"></div>
	<script type="text/javascript">

	    var disqus_shortname = 'freetux-1';

	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();

	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

</article>

      </div>
    </div>
  </div>


  <footer class="footer">
    <div class="social-icon">
    <a href="mailto:itsfreetux.protonmail.com"><i class="fa fa-envelope" aria-hidden="true"></i></a>


    <a href="https://github.com/herotux"><i class="fab fa-github" aria-hidden="true"></i></a>


    <a href="https://instagram.com/freetux"><i class="fab fa-instagram" aria-hidden="true"></i></a>


    <a href="https://www.linkedin.com/in/freetux"><i class="fab fa-linkedin" aria-hidden="true"></i></a>


    <a href="https://www.twitter.com/sahand240"><i class="fab fa-twitter" aria-hidden="true"></i></a>


    <a rel="me" href="https://persadon.com/@Freetux"><i class="fab fa-mastodon" aria-hidden="true"></i></a>

    <a href="/feed.xml"><i class="fa fa-rss" aria-hidden="true"></i></a></div>
    <div class="footer-text">
      <i class="fa fa-copyright"></i> حمید صیدی 2018
      <i class="fa fa-heart heart-color"></i>
    </div>
  </footer>



  
	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-127734624-1', 'auto');
		ga('send', 'pageview', {
		  'page': '/mastodon-install/',
		  'title': 'نصب Mastodon در اوبونتو'
		});
	</script>
	<!-- End Google Analytics -->


  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.3/js/bootstrap.min.js" integrity="sha384-a5N7Y/aK3qNeh15eJKGWxsqtnX/wWdSZSKp+81YjTmS15nvnvxKHuzaWwXHDli+4"
    crossorigin="anonymous"></script>
  <!-- Matomo -->
  <script type="text/javascript">
    var _paq = _paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="//matomo.rasooll.com/";
      _paq.push(['setTrackerUrl', u+'piwik.php']);
      _paq.push(['setSiteId', '1']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
    })();
  </script>
  <!-- End Matomo Code -->
  <script src="//static.getclicky.com/js" type="text/javascript"></script>
  <script type="text/javascript">try { clicky.init(101072468); } catch (e) { }</script>
  <noscript>
    <p>
      <img alt="Clicky" width="1" height="1" src="//in.getclicky.com/101072468ns.gif" />
    </p>
  </noscript>
</body>

</html>
